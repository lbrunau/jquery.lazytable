!function(t){var n={};function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";e.r(n);e(2),e(1);function o(t,n){this.generatorFunction=t,this.rows=n,this.current=0}o.prototype.clone=function(){var t=new o(this.generatorFunction);return t.rows=this.rows,t.current=this.current,t},o.prototype.getCurrent=function(){return this.current},o.prototype.setCurrent=function(t){t>=0&&t<this.rows.length&&(this.current=t)},o.prototype.next=function(){return this.generatorFunction(this.rows[this.current++])},o.prototype.hasNext=function(){return this.current<this.rows.length},o.prototype.prev=function(){return this.generatorFunction(this.rows[--this.current])},o.prototype.hasPrev=function(){return this.current>0};class r{constructor(t){this.state=t,this.callbacks=[],this.transitions={}}addTransition(t,n,e){this.transitions[t]||(this.transitions[t]={}),this.transitions[t][n]=e}_transitState(t){const n=this.state;this.state=t;for(let e of this.callbacks)e(n,t)}trigger(t,n){const e=this;if(this.transitions[this.state]&&this.transitions[this.state][t])return new Promise((o,r)=>{const i=()=>{e._transitState(e.transitions[e.state][t]),o()};"function"==typeof n?n().then(i):i()});throw new Exception("Undefined state transition: {state: "+this.state+", action: "+t+"}")}getState(){return this.state}onStateEnter(t,n){"function"==typeof n&&this.onStateChange(function(e,o){o==t&&n()})}onStateLeave(t,n){"function"==typeof n&&this.onStateChange(function(e,o){e==t&&n()})}onStateChange(t){"function"==typeof t&&this.callbacks.push(t)}}const i={EMPTY:1,IDLE:2,STARTING:3,UPDATING:4,RESETTING:5},a={START:1,RESET:2,SCROLL:3,SCROLL_COMPLETE:4};class s extends r{constructor(){super(i.EMPTY),this.addTransition(i.EMPTY,a.START,i.STARTING),this.addTransition(i.STARTING,a.SCROLL,i.UPDATING),this.addTransition(i.STARTING,a.RESET,i.RESETTING),this.addTransition(i.UPDATING,a.SCROLL_COMPLETE,i.IDLE),this.addTransition(i.UPDATING,a.SCROLL,i.UPDATING),this.addTransition(i.UPDATING,a.RESET,i.RESETTING),this.addTransition(i.IDLE,a.SCROLL,i.UPDATING),this.addTransition(i.IDLE,a.RESET,i.RESETTING),this.addTransition(i.RESETTING,a.RESET,i.RESETTING),this.addTransition(i.RESETTING,a.START,i.STARTING)}}function c(t){const n=this,e=this.find("table"),r=this.find("table tbody"),c={debug:!1,trHeight:0,data:[],generator:function(t){return"<tr><td>"+t.join("</td><td>")+"</td></tr>"},startIndex:0,keepExisting:!0,prefetch:0,animationCalcTime:3,appendFn:function(t){r.append(t.join())},prependFn:function(t){r.prepend(t.join())},deleteFn:function(t,n){r.children().slice(t,n).remove()},onInit:null,onRedraw:null},u=$.extend({},c,t),h=new o(u.generator,u.data);h.setCurrent(u.startIndex);const l=h.clone(),g=new s;var f=!1,d=!1;const p=function(){return new Promise((t,n)=>{var e=1;const o=function(){const i=r.children();i.length>0?window.setTimeout(function(){t(i.get(0))},16):e++<10?window.setTimeout(o,100):n()};o()})},m=function(t,n,e){return new Promise((o,r)=>{const a=function(r){const s=w();for(var c=[];g.getState()!=i.RESETTING&&n(s)&&window.performance.now()-r<u.animationCalcTime;)c.push(t());c.length>0&&e(c),n(s)?window.requestAnimationFrame(a):o(c)};window.requestAnimationFrame(a)})},w=function(){const t=n.scrollTop(),e={top:Math.max(Math.floor(t/u.trHeight)-u.prefetch,0),bottom:Math.min(Math.ceil((t+n.innerHeight())/u.trHeight)+u.prefetch,u.data.length-1)};return e.center=Math.min(Math.floor((e.bottom+e.top)/2),u.data.length-1),e},T=function(){const t={top:l.getCurrent(),bottom:h.getCurrent()};return t.center=Math.min(Math.floor((t.bottom+t.top)/2),u.data.length-1),t},b=function(){const t=w(),n=T();if(t.top>n.bottom||t.bottom<n.top)return g.trigger(a.RESET).then(y(t.center));var o=[];return t.bottom>=n.bottom&&o.push(m(()=>h.next(),t=>g.getState()!=i.RESETING&&h.hasNext()&&h.getCurrent()<=t.bottom,t=>{u.appendFn(t),e.css({"margin-bottom":(u.data.length-h.getCurrent())*u.trHeight}),u.debug&&console.log("[jQuery.Lazytable] bot +"+t.length+" rows")})),t.top<n.top&&o.push(m(()=>l.prev(),t=>g.getState()!=i.RESETING&&l.hasPrev()&&l.getCurrent()>t.top,t=>{u.prependFn(t.reverse()),e.css({"margin-top":l.getCurrent()*u.trHeight}),u.debug&&console.log("[jQuery.Lazytable] top +"+t.length+" rows")})),o.length>0?g.trigger(a.SCROLL,()=>Promise.all(o).then(()=>{u.keepExisting||function(){const t=T(),n=w();n.bottom<t.bottom&&(h.setCurrent(n.bottom),u.deleteFn(n.bottom-t.bottom),e.css({"margin-bottom":(u.data.length-n.bottom)*u.trHeight}),u.debug&&console.log("[jQuery.Lazytable] bot -"+(t.bottom-n.bottom)+" rows")),n.top>t.top&&(l.setCurrent(n.top),u.deleteFn(0,n.top-t.top),e.css({"margin-top":n.top*u.trHeight}),u.debug&&console.log("[jQuery.Lazytable] top -"+(n.top-t.top)+" rows"))}(),"function"==typeof u.onRedraw&&u.onRedraw()})).then(()=>{g.trigger(a.SCROLL_COMPLETE)}):void 0},E=function(t){return new Promise((e,o)=>{const r=Math.min(Math.max(t*u.trHeight-(n.innerHeight()-u.trHeight)/2,0),n.prop("scrollHeight"));n.scrollTop(r),window.setTimeout(e,16)})},S=function(t){const e=T();return d=t,e.top<=t&&t<e.bottom?g.trigger(a.SCROLL,()=>(function(t){return new Promise((e,o)=>{const r=t*u.trHeight,i=n.scrollTop(),a=n.innerHeight();var s=-1;r+u.trHeight>i+a?s=Math.max(0,r-(a-u.trHeight)):r<i&&(s=r),s>=0&&n.scrollTop(s),window.setTimeout(e,16)})})(t)):g.trigger(a.RESET).then(()=>y(t))};const y=function(t){return C(t,!1).then(function(){return E(t)}).then(b)},C=function(t,n){return g.trigger(a.START,()=>new Promise((o,r)=>{const i=function(){const n=t*u.trHeight,r=u.trHeight*u.data.length-n-u.trHeight;e.css({"margin-bottom":r,"margin-top":n}),o()};u.deleteFn(0),h.setCurrent(t),l.setCurrent(t),h.hasNext()?(u.appendFn([h.next()]),n?p().then(function(t){const n=window.getComputedStyle(t).getPropertyValue("height").match(/([\.\d]+)px/);u.trHeight=n?parseFloat(n[1]):t.offsetHeight}).then(i):i()):i()}))};return u.debug&&(g.onStateChange((t,n)=>{console.log("[jQuery.Lazytable] State change: "+t+" -> "+n)}),g.onStateEnter(i.IDLE,()=>{const t=h.getCurrent()-l.getCurrent(),n=e.css("margin-top"),o=parseInt(n.substr(0,n.length-2)),r=e.css("margin-bottom"),i=parseInt(r.substr(0,r.length-2));console.log("[jQuery.Lazytable] nVisible: "+t),console.assert(o+i==(u.data.length-t)*u.trHeight,{message:"margin claculation wrong",nTotal:u.data.length,nVisible:t,top:o,bottom:i,trHeight:u.trHeight})})),e.addClass("empty"),g.onStateLeave(i.EMPTY,()=>{e.removeClass("empty"),e.addClass("loading")}),g.onStateEnter(i.IDLE,()=>{e.removeClass("loading")}),g.onStateLeave(i.IDLE,()=>{e.addClass("loading")}),n.off("scroll"),n.off("lazytable:focus"),n.off("lazytable:resize"),n.css({"overflow-y":"hidden"}),C(u.startIndex,!0).then(function(){return E(u.startIndex)}).then(b).then(function(){n.css({"overflow-y":"scroll"}),"function"==typeof u.onInit&&u.onInit(),n.on("scroll",function(){b()}),n.on("lazytable:focus",function(t,n,e){S(n).then(function(){"function"==typeof e&&e()})}),n.on("lazytable:resize",function(){f||(f=!0,p().then(t=>{var n;const e=(n=window.getComputedStyle(t).getPropertyValue("height").match(/([\.\d]+)px/))?parseFloat(n[1]):t.offsetHeight;if(e>0&&e!=u.trHeight){u.trHeight=e;const t=d||Math.min(Math.floor((l.getCurrent()+h.getCurrent())/2),u.data.length-1);return y(t)}if(d)return S(d)}).then(b).finally(function(){f=!1}))})}),this}jQuery.fn.LazyTable=c},function(t,n){!function(t){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var n=Date.now();performance.timing&&performance.timing.navigationStart&&(n=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-n}}}()},function(t,n){!function(t){for(var n=0,e=["ms","moz","webkit","o"],o=0;o<e.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[e[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[o]+"CancelAnimationFrame"]||window[e[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var o=(new Date).getTime(),r=Math.max(0,16-(o-n)),i=window.setTimeout(function(){t(o+r)},r);return n=o+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}()}]);